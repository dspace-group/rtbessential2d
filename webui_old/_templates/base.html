<!doctype html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Essential 2D</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.3/css/bulma.min.css">
    <script type="text/javascript">
        setInterval(interval, 500);
        function interval() {
            fetch("/info").then(function(response) {
                return response.json();
            }).then(function(data) {
                document.getElementById("system").textContent = data["system"];
                document.getElementById("machine").textContent = data["machine"];
                document.getElementById("state").textContent = data["state"];
                document.getElementById("ecstate").textContent = data["ecstate"];

                ifselectionDiv = document.getElementById("interfaceselection")
                interfacelistDiv = document.getElementById("interfacelist")
                logsDiv = document.getElementById("logs")

                // Control
                interfacelistDiv.innerText  = '';
                switch(data["state"]) {
                    case "Not initialized":
                        data["interfaces"].forEach((item) => {
                            button = document.createElement("button");
                            button.textContent = item["name"];
                            button.className = "button is-normal";

                            a = document.createElement("a");
                            a.href = "/initialize/" + item["name"];
                            a.appendChild(button);

                            interfacelistDiv.appendChild(a);                            
                        });
                        ifselectionDiv.style.display = '';
                        break;
                }

                // Log messages
                logsDiv.innerText  = '';
                data["logs"].reverse().forEach((item) => {
                    entry = document.createElement("p");
                    len = data["logs"].length;
                    if(len == 5 && data["logs"][len-1] === item) {
                        entry.style.opacity = 0.3;
                    }
                    entry.textContent = `${item["time"]} ${item["type"]} ${item["msg"]}`;
                    logsDiv.appendChild(entry);
                });
            });
        }
    </script>
</head>

<body>
    <section class="hero">
        <div class="hero-body">
          <p class="title">
            dSPACE RTB Essential 2D
          </p>
          <p class="subtitle">
            radar test bench demo webui
          </p>
        </div>
    </section>

    <div class="tile">
        <div class="tile is-vertical is-8">
          <div class="tile">
            <div class="tile is-parent is-vertical">
                <article class="tile is-child notification is-info">
                    <p class="title">ðŸ©º</p>
                    <p class="subtitle">System information</p>
                    <p>State: <strong id="state">-</strong></p>
                    <p>System: <strong id="system">-</strong>, Machine: <strong id="machine">-</strong></p>
                </article>
                <article class="tile is-child notification is-info">
                    <p class="title">ðŸ©º</p>
                    <p class="subtitle">EtherCAT information</p>
                    <p>State: <strong id="ecstate">-</strong></p>
                </article>
            </div>
            <div class="tile is-parent">
              <article class="tile is-child notification is-danger">
                <p class="title">ðŸŽ®</p>
                <p class="subtitle">Control</p>
                <div id="interfaceselection" class="content" style="display:none">
                    <p>You'll need to initialize an interface for EtherCAT communication first:</p>
                    <div id="interfacelist" class="buttons"></div>
                </div>                
              </article>
            </div>
          </div>
          <div class="tile is-parent">
            <article class="tile is-child notification is-info">
              <p class="title">ðŸ“£</p>
              <p class="subtitle">Log messages</p>
              <div id="logs" class="content">
              </div>
            </article>
          </div>
        </div>
        <div class="tile is-parent">
          <article class="tile is-child notification is-success">
            <div class="content">
              <p class="title">ðŸ“Š</p>
              <p class="subtitle">Visualization</p>
              <div class="content">

              </div>
            </div>
          </article>
        </div>
      </div>

    <footer class="footer">
        <div class="content has-text-centered">
          <p>
            by <a href="https://www.dspace.de/"><img src="{{ url_for('static', filename='dSPACE_success.png') }}"></a>
          </p>
        </div>
      </footer>
</body>